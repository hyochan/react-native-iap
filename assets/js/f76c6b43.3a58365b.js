"use strict";(self.webpackChunkreact_native_iap_docs=self.webpackChunkreact_native_iap_docs||[]).push([[6876],{16782:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"examples/subscription-flow","title":"Subscriptions Flow Example","description":"The complete working example can be found at example/screens/SubscriptionFlow.tsx.","source":"@site/versioned_docs/version-14.6/examples/subscription-flow.md","sourceDirName":"examples","slug":"/examples/subscription-flow","permalink":"/react-native-iap/docs/14.6/examples/subscription-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/react-native-iap/tree/main/docs/versioned_docs/version-14.6/examples/subscription-flow.md","tags":[],"version":"14.6","sidebarPosition":2,"frontMatter":{"title":"Subscriptions Flow Example","sidebar_label":"Subscriptions Flow","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Purchase Flow","permalink":"/react-native-iap/docs/14.6/examples/purchase-flow"},"next":{"title":"Available Purchases","permalink":"/react-native-iap/docs/14.6/examples/available-purchases"}}');var r=i(74848),t=i(28453),a=i(35159),c=i(71437);const o={title:"Subscriptions Flow Example",sidebar_label:"Subscriptions Flow",sidebar_position:2},l="Subscriptions Flow",d={},h=[{value:"Flow Overview",id:"flow-overview",level:2},{value:"Quick Start with useIAP",id:"quick-start-with-useiap",level:2},{value:"Checking Active Subscriptions",id:"checking-active-subscriptions",level:2},{value:"Plan Changes (Upgrade/Downgrade)",id:"plan-changes-upgradedowngrade",level:2},{value:"iOS",id:"ios",level:3},{value:"Android",id:"android",level:3},{value:"Android Replacement Modes",id:"android-replacement-modes",level:2},{value:"IAPKit Server Verification",id:"iapkit-server-verification",level:2},{value:"Setup",id:"setup",level:3},{value:"Usage",id:"usage",level:3},{value:"Testing",id:"testing",level:3},{value:"Key Points",id:"key-points",level:2},{value:"Resources",id:"resources",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"subscriptions-flow",children:"Subscriptions Flow"})}),"\n",(0,r.jsx)(a.A,{}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["The complete working example can be found at ",(0,r.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/blob/main/example/screens/SubscriptionFlow.tsx",children:"example/screens/SubscriptionFlow.tsx"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"flow-overview",children:"Flow Overview"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Connect \u2192 Fetch Subscriptions \u2192 Request Purchase \u2192 Validate \u2192 Finish Transaction\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quick-start-with-useiap",children:"Quick Start with useIAP"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const {subscriptions, fetchProducts, requestPurchase, finishTransaction} =\n  useIAP({\n    onPurchaseSuccess: async (purchase) => {\n      // Validate on your server, then finish\n      await finishTransaction({purchase});\n    },\n    onPurchaseError: (error) => {\n      if (error.code !== ErrorCode.UserCancelled) {\n        Alert.alert('Error', error.message);\n      }\n    },\n  });\n\n// Load subscriptions\nawait fetchProducts({skus: ['premium_monthly'], type: 'subs'});\n\n// Purchase (platform-specific)\nconst subscription = subscriptions[0];\nawait requestPurchase({\n  request: {\n    apple: {sku: 'premium_monthly'},\n    google: {\n      skus: ['premium_monthly'],\n      subscriptionOffers:\n        subscription.subscriptionOfferDetailsAndroid?.map((offer) => ({\n          sku: subscription.id,\n          offerToken: offer.offerToken,\n        })) || [],\n    },\n  },\n  type: 'subs',\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"checking-active-subscriptions",children:"Checking Active Subscriptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const {getActiveSubscriptions, hasActiveSubscriptions} = useIAP();\n\n// Quick check\nconst isActive = await hasActiveSubscriptions(['premium_monthly']);\n\n// Get details\nconst activeList = await getActiveSubscriptions();\n"})}),"\n",(0,r.jsx)(n.h2,{id:"plan-changes-upgradedowngrade",children:"Plan Changes (Upgrade/Downgrade)"}),"\n",(0,r.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,r.jsx)(n.p,{children:"Subscriptions in the same group auto-replace each other. Just purchase the new plan."}),"\n",(0,r.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,r.jsx)(n.p,{children:"Requires explicit replacement with the current purchase token:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"await requestPurchase({\n  request: {\n    google: {\n      skus: ['premium_yearly'],\n      subscriptionOffers: [...],\n      purchaseTokenAndroid: currentPurchase.purchaseToken, // Required\n      replacementModeAndroid: 1, // WITH_TIME_PRORATION\n    },\n  },\n  type: 'subs',\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"android-replacement-modes",children:"Android Replacement Modes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Value"}),(0,r.jsx)(n.th,{children:"Mode"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:"WITH_TIME_PRORATION"}),(0,r.jsx)(n.td,{children:"Immediate with prorated credit"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})}),(0,r.jsx)(n.td,{children:"CHARGE_PRORATED_PRICE"}),(0,r.jsx)(n.td,{children:"Immediate with prorated charge"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"6"})}),(0,r.jsx)(n.td,{children:"DEFERRED"}),(0,r.jsx)(n.td,{children:"Change at next renewal"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"iapkit-server-verification",children:"IAPKit Server Verification"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(c.A,{children:"IAPKit"})," provides server-side subscription verification without your own infrastructure."]}),"\n",(0,r.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Get your API key from ",(0,r.jsx)(c.A,{children:"IAPKit Dashboard"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Add environment variable:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"EXPO_PUBLIC_IAPKIT_API_KEY=your_api_key_here\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {verifyPurchaseWithProvider} from 'react-native-iap';\n\nconst {finishTransaction} = useIAP({\n  onPurchaseSuccess: async (purchase) => {\n    const result = await verifyPurchaseWithProvider({\n      provider: 'iapkit',\n      iapkit: {\n        apiKey: process.env.EXPO_PUBLIC_IAPKIT_API_KEY!,\n        apple: {jws: purchase.purchaseToken!},\n        google: {purchaseToken: purchase.purchaseToken!},\n      },\n    });\n\n    if (result.iapkit.isValid) {\n      await finishTransaction({purchase});\n    }\n  },\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/blob/main/example/screens/SubscriptionFlow.tsx",children:"example app"})," has built-in IAPKit support. Set your API key and test subscription verification."]}),"\n",(0,r.jsx)(n.h2,{id:"key-points",children:"Key Points"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"iOS"}),": Use subscription groups for automatic plan management"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Android"}),": Must include ",(0,r.jsx)(n.code,{children:"subscriptionOffers"})," and ",(0,r.jsx)(n.code,{children:"purchaseTokenAndroid"})," for upgrades"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Always validate receipts on your server before granting access"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hook callbacks"}),": Use ",(0,r.jsx)(n.code,{children:"onPurchaseSuccess"})," instead of promise chaining"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/blob/main/example/screens/SubscriptionFlow.tsx",children:"Complete example"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.apple.com/app-store/subscriptions/",children:"iOS Subscription Groups"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.android.com/google/play/billing/subscriptions#upgrade-downgrade",children:"Android Subscription Changes"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},27856:(e,n,i)=>{i.d(n,{I:()=>r,V:()=>s});const s="https://iapkit.com",r="https://www.hyo.dev/api/ad-banner/cmjf0l2460003249hfyh029dm"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var s=i(96540);const r={},t=s.createContext(r);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(t.Provider,{value:n},e.children)}},35159:(e,n,i)=>{i.d(n,{A:()=>c});var s=i(96540),r=i(86025),t=i(27856),a=i(74848);function c({className:e="iapkit-banner",style:n}){const i=(0,r.Ay)("/img/iapkit-banner.gif"),c=(0,s.useCallback)(e=>{fetch(t.I,{method:"POST",mode:"no-cors"}).catch(()=>{})},[]);return(0,a.jsx)("div",{className:e,style:{marginTop:0,marginBottom:12,textAlign:"center",...n},children:(0,a.jsx)("a",{href:t.V,target:"_blank",rel:"noopener noreferrer",onClick:c,style:{display:"inline-block",textDecoration:"none"},children:(0,a.jsx)("img",{src:i,alt:"IapKit - In-App Purchase Validation Service",style:{border:"none",display:"block"}})})})}},71437:(e,n,i)=>{i.d(n,{A:()=>a});var s=i(96540),r=i(27856),t=i(74848);function a({children:e,className:n,style:i}){const a=(0,s.useCallback)(()=>{fetch(r.I,{method:"POST",mode:"no-cors"}).catch(()=>{})},[]);return(0,t.jsx)("a",{href:r.V,target:"_blank",rel:"noopener noreferrer",onClick:a,className:n,style:i,children:e})}}}]);