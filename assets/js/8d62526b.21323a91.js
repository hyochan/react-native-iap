"use strict";(self.webpackChunkreact_native_iap_docs=self.webpackChunkreact_native_iap_docs||[]).push([[9946],{1850:(e,n,i)=>{i.d(n,{A:()=>a});i(6540);var r=i(6025),s=i(4848);const t={default:{url:"https://www.greatfrontend.com?fpr=hyo73"},coding:{url:"https://www.greatfrontend.com/prepare/coding?fpr=hyo73",title:"Coding Interview Questions",description:"Practice coding problems for technical interviews"},quiz:{url:"https://www.greatfrontend.com/questions/formats/quiz?fpr=hyo73",title:"Quiz Interview Questions",description:"Test your knowledge with quiz-style questions"},"system-design":{url:"https://www.greatfrontend.com/questions/formats/system-design?fpr=hyo73",title:"Front End System Design Questions",description:"Master system design for frontend applications"},behavioral:{url:"https://www.greatfrontend.com/behavioral-interview-playbook?fpr=hyo73",title:"Behavioral Interview Questions",description:"Prepare for behavioral interview questions"},"interview-guide":{url:"https://www.greatfrontend.com/front-end-interview-playbook?fpr=hyo73",title:"Front End Interview Guidebook",description:"Complete guide to frontend interviews"},"system-design-guide":{url:"https://www.greatfrontend.com/front-end-system-design-playbook?fpr=hyo73",title:"Front End System Design Guidebook",description:"Comprehensive system design guide"},"study-plan":{url:"https://www.greatfrontend.com/interviews/study-plans?fpr=hyo73",title:"Study Plan",description:"Structured learning paths for interview preparation"},questions:{url:"https://www.greatfrontend.com/questions?fpr=hyo73",title:"Framework-specific Practice Questions",description:"Practice questions for popular frameworks"},javascript:{url:"https://www.greatfrontend.com/questions/js?fpr=hyo73",title:"JavaScript Interview Questions",description:"Master JavaScript for technical interviews"},react:{url:"https://www.greatfrontend.com/questions/react?fpr=hyo73",title:"React Interview Questions",description:"Prepare for React-specific interviews"}};function a({type:e="default",className:n="greatfrontend-banner",style:i}){const a=t[e],o=(0,r.Ay)("/img/greatfrontend-js.gif");return(0,s.jsxs)("div",{className:n,style:{marginTop:0,marginBottom:12,textAlign:"center",...i},children:[(0,s.jsx)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",textDecoration:"none"},children:(0,s.jsx)("img",{src:o,alt:"GreatFrontEnd",style:{maxWidth:"100%",height:"auto",border:"none",display:"block"}})}),a.title&&(0,s.jsx)("div",{style:{marginTop:0,fontSize:"0.85em"},children:(0,s.jsx)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--ifm-color-primary)",textDecoration:"underline",fontWeight:500,cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.textDecoration="underline",e.currentTarget.style.opacity="0.8"},onMouseLeave:e=>{e.currentTarget.style.textDecoration="underline",e.currentTarget.style.opacity="1"},children:a.title})})]})}},2725:(e,n,i)=>{i.d(n,{A:()=>o});var r=i(1850),s=i(6540),t=i(4848);const a=["coding","quiz","system-design","behavioral","interview-guide","system-design-guide","study-plan","questions","javascript","react"];function o(){const e=(0,s.useMemo)(()=>{const e=Math.floor(Math.random()*a.length);return a[e]},[]);return(0,t.jsx)(r.A,{type:e})}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}},8949:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"examples/purchase-flow","title":"Purchase Flow Example","description":"This guide demonstrates a clean purchase flow using react-native-iap with the useIAP hook and the new platform\u2011specific request shape.","source":"@site/docs/examples/purchase-flow.md","sourceDirName":"examples","slug":"/examples/purchase-flow","permalink":"/react-native-iap/docs/examples/purchase-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/react-native-iap/tree/main/docs/docs/examples/purchase-flow.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Purchase Flow Example","sidebar_label":"Purchase Flow","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Error Handling","permalink":"/react-native-iap/docs/api/error-handling"},"next":{"title":"Subscriptions Flow","permalink":"/react-native-iap/docs/examples/subscription-flow"}}');var s=i(4848),t=i(8453),a=i(2725);const o={title:"Purchase Flow Example",sidebar_label:"Purchase Flow",sidebar_position:1},c="Purchase Flow",l={},d=[{value:"Flow Overview",id:"flow-overview",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"1. Connection Management",id:"1-connection-management",level:3},{value:"2. Product Loading",id:"2-product-loading",level:3},{value:"3. Purchase Flow",id:"3-purchase-flow",level:3},{value:"4. Receipt Validation",id:"4-receipt-validation",level:3},{value:"5. User Experience",id:"5-user-experience",level:3},{value:"Platform Differences",id:"platform-differences",level:2},{value:"Purchase Request Parameters",id:"purchase-request-parameters",level:3},{value:"Key iOS Options",id:"key-ios-options",level:3},{value:"Purchase Object Properties",id:"purchase-object-properties",level:3},{value:"Receipt Validation",id:"receipt-validation",level:3},{value:"Usage",id:"usage",level:2},{value:"Customization",id:"customization",level:2},{value:"IAPKit Verification Setup",id:"iapkit-verification-setup",level:2},{value:"1. Install react-native-dotenv",id:"1-install-react-native-dotenv",level:3},{value:"2. Configure babel.config.js",id:"2-configure-babelconfigjs",level:3},{value:"3. Create .env file",id:"3-create-env-file",level:3},{value:"4. Add TypeScript declarations",id:"4-add-typescript-declarations",level:3},{value:"5. Verify purchases with IAPKit",id:"5-verify-purchases-with-iapkit",level:3},{value:"6. Integrate with useIAP",id:"6-integrate-with-useiap",level:3},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"purchase-flow",children:"Purchase Flow"})}),"\n",(0,s.jsx)(a.A,{}),"\n",(0,s.jsxs)(n.p,{children:["This guide demonstrates a clean purchase flow using react-native-iap with the ",(0,s.jsx)(n.code,{children:"useIAP"})," hook and the new platform\u2011specific request shape."]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.mdxAdmonitionTitle,{children:["The complete working example can be found at ",(0,s.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/blob/main/example/screens/PurchaseFlow.tsx",children:"example/screens/PurchaseFlow.tsx"}),"."]}),(0,s.jsx)(n.p,{children:"Note that the example code was heavily vibe-coded with Claude and is quite verbose/messy for demonstration purposes - use it as a reference only. :::"}),(0,s.jsx)(n.h2,{id:"flow-overview",children:"Flow Overview"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Initialize: ",(0,s.jsx)(n.code,{children:"useIAP"})," manages the store connection lifecycle"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Load products:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"fetchProducts({ skus, type: 'in-app' })"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start purchase:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"requestPurchase({ request: { ios: { sku }, android: { skus: [sku] } }, type: 'in-app' })"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Receive callbacks: ",(0,s.jsx)(n.code,{children:"onPurchaseSuccess"})," / ",(0,s.jsx)(n.code,{children:"onPurchaseError"})," (from ",(0,s.jsx)(n.code,{children:"useIAP"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Validate server\u2011side: send receipt/JWS or token to your backend"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Finish transaction:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"finishTransaction({ purchase, isConsumable })"})}),"\n"]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"Connect \u2192 Fetch Products \u2192 Request Purchase \u2192 Server Validate \u2192 Finish Transaction\n"})}),(0,s.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),(0,s.jsx)(n.h3,{id:"1-connection-management",children:"1. Connection Management"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"useIAP"})," automatically opens/closes the connection"]}),"\n",(0,s.jsxs)(n.li,{children:["Exposes ",(0,s.jsx)(n.code,{children:"connected"}),", convenient for showing loading states"]}),"\n"]}),(0,s.jsx)(n.h3,{id:"2-product-loading",children:"2. Product Loading"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Load in\u2011app products or subscriptions (set ",(0,s.jsx)(n.code,{children:"type"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Handle and log failed product fetches"}),"\n"]}),(0,s.jsx)(n.h3,{id:"3-purchase-flow",children:"3. Purchase Flow"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Start purchases via unified request shape (no ",(0,s.jsx)(n.code,{children:"Platform.OS"})," branching)"]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"onPurchaseSuccess"}),"/",(0,s.jsx)(n.code,{children:"onPurchaseError"})," from ",(0,s.jsx)(n.code,{children:"useIAP"})]}),"\n",(0,s.jsxs)(n.li,{children:["Always call ",(0,s.jsx)(n.code,{children:"finishTransaction"})," after server validation"]}),"\n"]}),(0,s.jsx)(n.h3,{id:"4-receipt-validation",children:"4. Receipt Validation"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Perform validation on your backend (never only on device)"}),"\n",(0,s.jsx)(n.li,{children:"iOS: validate the receipt/JWS; Android: validate purchase token + package name"}),"\n"]}),(0,s.jsx)(n.h3,{id:"5-user-experience",children:"5. User Experience"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Provide clear states for loading, success, and error"}),"\n",(0,s.jsx)(n.li,{children:"Show subscription management/deep\u2011links when appropriate"}),"\n"]}),(0,s.jsx)(n.h2,{id:"platform-differences",children:"Platform Differences"}),(0,s.jsx)(n.h3,{id:"purchase-request-parameters",children:"Purchase Request Parameters"}),(0,s.jsxs)(n.p,{children:["Use the modern, platform\u2011specific request container (v2.7.0+). This avoids manual ",(0,s.jsx)(n.code,{children:"Platform.OS"})," checks:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"await requestPurchase({\n  request: {\n    ios: {sku: productId, quantity: 1},\n    android: {skus: [productId]},\n  },\n  type: 'in-app',\n});\n"})}),(0,s.jsx)(n.p,{children:"Notes:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Keep ",(0,s.jsx)(n.code,{children:"andDangerouslyFinishTransactionAutomatically"})," off (default) to validate first."]}),"\n"]}),(0,s.jsx)(n.h3,{id:"key-ios-options",children:"Key iOS Options"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"appAccountToken"}),": set per user to correlate receipts on your backend"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"quantity"}),": purchase quantity for iOS (consumables)"]}),"\n"]}),(0,s.jsx)(n.h3,{id:"purchase-object-properties",children:"Purchase Object Properties"}),(0,s.jsx)(n.p,{children:"Purchase objects have different properties on iOS and Android. When accessing platform-specific properties, TypeScript type casting is required:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// Unified fields\nconst token = purchase.purchaseToken; // iOS JWS or Android token\n\n// Android-only helpers\n// const pkg = (purchase as PurchaseAndroid).packageNameAndroid;\n"})}),(0,s.jsx)(n.h3,{id:"receipt-validation",children:"Receipt Validation"}),(0,s.jsx)(n.p,{children:"Receipt validation requires different approaches:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"iOS: verify receipt/JWS on your server against Apple"}),"\n",(0,s.jsx)(n.li,{children:"Android: verify token and package name against Google Play Developer API"}),"\n"]}),(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import React from 'react';\nimport {NavigationContainer} from '@react-navigation/native';\nimport PurchaseFlow from './purchase-flow';\n\nexport default function App() {\n  return (\n    <NavigationContainer>\n      <PurchaseFlow />\n    </NavigationContainer>\n  );\n}\n"})}),(0,s.jsx)(n.h2,{id:"customization",children:"Customization"}),(0,s.jsx)(n.p,{children:"You can customize this example by:"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Styling"}),": Modify the ",(0,s.jsx)(n.code,{children:"styles"})," object to match your app's design"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Product IDs"}),": Update ",(0,s.jsx)(n.code,{children:"PRODUCT_IDS"})," with your actual product IDs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation"}),": Implement proper server-side receipt validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Handling"}),": Add more specific error handling for your use case"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Features"}),": Add features like purchase restoration, subscription management, etc."]}),"\n"]}),(0,s.jsx)(n.h2,{id:"iapkit-verification-setup",children:"IAPKit Verification Setup"}),(0,s.jsxs)(n.p,{children:["For server-side receipt validation without managing your own infrastructure, you can use ",(0,s.jsx)(n.a,{href:"https://iapkit.com",children:"IAPKit"}),"."]}),(0,s.jsx)(n.h3,{id:"1-install-react-native-dotenv",children:"1. Install react-native-dotenv"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn add react-native-dotenv\n"})}),(0,s.jsx)(n.h3,{id:"2-configure-babelconfigjs",children:"2. Configure babel.config.js"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"module.exports = {\n  presets: ['module:@react-native/babel-preset'],\n  plugins: [\n    [\n      'module:react-native-dotenv',\n      {\n        moduleName: '@env',\n        path: '.env',\n      },\n    ],\n  ],\n};\n"})}),(0,s.jsx)(n.h3,{id:"3-create-env-file",children:"3. Create .env file"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"IAPKIT_API_KEY=your_iapkit_api_key_here\n"})}),(0,s.jsx)(n.h3,{id:"4-add-typescript-declarations",children:"4. Add TypeScript declarations"}),(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"src/types/env.d.ts"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"declare module '@env' {\n  export const IAPKIT_API_KEY: string;\n}\n"})}),(0,s.jsx)(n.h3,{id:"5-verify-purchases-with-iapkit",children:"5. Verify purchases with IAPKit"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import {Platform} from 'react-native';\nimport {verifyPurchaseWithProvider, Purchase} from 'react-native-iap';\nimport {IAPKIT_API_KEY} from '@env';\n\nconst verifyWithIAPKit = async (purchase: Purchase) => {\n  const result = await verifyPurchaseWithProvider({\n    provider: 'iapkit',\n    iapkit: {\n      apiKey: IAPKIT_API_KEY,\n      environment: __DEV__ ? 'sandbox' : 'production',\n      apple:\n        Platform.OS === 'ios'\n          ? {\n              jws: purchase.purchaseToken!,\n            }\n          : undefined,\n      google:\n        Platform.OS === 'android'\n          ? {\n              purchaseToken: purchase.purchaseToken!,\n              packageName: 'com.your.app',\n              productId: purchase.productId,\n            }\n          : undefined,\n    },\n  });\n\n  return result;\n};\n"})}),(0,s.jsx)(n.h3,{id:"6-integrate-with-useiap",children:"6. Integrate with useIAP"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const {finishTransaction} = useIAP({\n  onPurchaseSuccess: async (purchase) => {\n    try {\n      // Verify with IAPKit before finishing\n      const result = await verifyWithIAPKit(purchase);\n\n      if (result.iapkit.isValid) {\n        await finishTransaction({purchase, isConsumable: true});\n        Alert.alert('Success', 'Purchase verified and completed!');\n      } else {\n        Alert.alert('Error', 'Purchase verification failed');\n      }\n    } catch (error) {\n      console.error('Verification error:', error);\n    }\n  },\n});\n"})}),(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Implement proper ",(0,s.jsx)(n.a,{href:"../guides/purchases#receipt-validation",children:"receipt validation"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.a,{href:"../guides/purchases#purchase-restoration",children:"purchase restoration"})]}),"\n",(0,s.jsxs)(n.li,{children:["Handle ",(0,s.jsx)(n.a,{href:"../api/methods/core-methods#deeplinktosubscriptions",children:"subscription management"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add comprehensive ",(0,s.jsx)(n.a,{href:"../api/error-handling",children:"error handling"})]}),"\n"]})]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);