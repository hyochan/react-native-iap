"use strict";(self.webpackChunkreact_native_iap_docs=self.webpackChunkreact_native_iap_docs||[]).push([[4171],{12037:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"troubleshooting/storekit2-migration","title":"StoreKit 2 Migration Issues","description":"When upgrading from react-native-iap v12/v13 (StoreKit 1) to v14+ (StoreKit 2), you may encounter the following error:","source":"@site/docs/troubleshooting/storekit2-migration.md","sourceDirName":"troubleshooting","slug":"/troubleshooting/storekit2-migration","permalink":"/react-native-iap/docs/troubleshooting/storekit2-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/react-native-iap/tree/main/docs/docs/troubleshooting/storekit2-migration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"StoreKit 2 Migration Issues"}}');var s=i(74848),r=i(28453);const o={sidebar_position:3,title:"StoreKit 2 Migration Issues"},c="StoreKit 2 Migration Issues",l={},d=[{value:"1. App Store Connect Agreements",id:"1-app-store-connect-agreements",level:2},{value:"2. iOS Version Requirements",id:"2-ios-version-requirements",level:2},{value:"3. Product Configuration",id:"3-product-configuration",level:2},{value:"4. Sandbox Testing",id:"4-sandbox-testing",level:2},{value:"5. StoreKit Configuration File (Local Testing)",id:"5-storekit-configuration-file-local-testing",level:2},{value:"6. Clean Build",id:"6-clean-build",level:2},{value:"7. Code Implementation",id:"7-code-implementation",level:2},{value:"8. Understanding StoreKitError Codes",id:"8-understanding-storekiterror-codes",level:2},{value:"Debugging Checklist",id:"debugging-checklist",level:2},{value:"Common Migration Issues",id:"common-migration-issues",level:2},{value:"Products worked in v12/v13 but not in v14+",id:"products-worked-in-v12v13-but-not-in-v14",level:3},{value:"Simulator vs Device",id:"simulator-vs-device",level:3},{value:"Receipt Validation Changes",id:"receipt-validation-changes",level:3},{value:"Still Having Issues?",id:"still-having-issues",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"storekit-2-migration-issues",children:"StoreKit 2 Migration Issues"})}),"\n",(0,s.jsxs)(n.p,{children:["When upgrading from ",(0,s.jsx)(n.code,{children:"react-native-iap"})," v12/v13 (StoreKit 1) to v14+ (StoreKit 2), you may encounter the following error:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:'[RN-IAP] Error fetching products: Error: PurchaseError(code: OpenIAP.ErrorCode.queryProduct,\nmessage: "The operation couldn\'t be completed. (StoreKit.StoreKitError error 1.)", productId: nil)\n'})}),"\n",(0,s.jsx)(n.p,{children:"This guide covers the common causes and solutions."}),"\n",(0,s.jsx)(n.h2,{id:"1-app-store-connect-agreements",children:"1. App Store Connect Agreements"}),"\n",(0,s.jsx)(n.p,{children:"StoreKit 2 requires up-to-date agreements. Check in App Store Connect:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Agreements, Tax, and Banking"})]}),"\n",(0,s.jsxs)(n.li,{children:["Verify ",(0,s.jsx)(n.strong,{children:"Paid Applications"})," contract is ",(0,s.jsx)(n.strong,{children:"Active"})]}),"\n",(0,s.jsx)(n.li,{children:"If expired or pending, accept the new agreement"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,s.jsx)(n.p,{children:"Even if your app was working before, Apple periodically requires agreement renewals. This is the most common cause of StoreKit 2 errors."})}),"\n",(0,s.jsx)(n.h2,{id:"2-ios-version-requirements",children:"2. iOS Version Requirements"}),"\n",(0,s.jsx)(n.p,{children:"StoreKit 2 has minimum version requirements:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS 15.0+"})," on device"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Xcode 13+"})," for building"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Verify your ",(0,s.jsx)(n.code,{children:"Podfile"})," has the correct minimum version:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ruby",children:"platform :ios, '15.0'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3-product-configuration",children:"3. Product Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Verify your products in App Store Connect:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Check"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Product Status"}),(0,s.jsx)(n.td,{children:'Must be "Ready to Submit" or "Approved"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Bundle ID"}),(0,s.jsx)(n.td,{children:"Must match your app's bundle identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Product ID"}),(0,s.jsx)(n.td,{children:"Case-sensitive, must be exact match"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pricing"}),(0,s.jsx)(n.td,{children:"Must have a price configured"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"4-sandbox-testing",children:"4. Sandbox Testing"}),"\n",(0,s.jsx)(n.p,{children:"For development testing:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"App Store Connect \u2192 Users and Access \u2192 Sandbox \u2192 Testers"})]}),"\n",(0,s.jsx)(n.li,{children:"Create a sandbox tester account"}),"\n",(0,s.jsx)(n.li,{children:"On your test device, sign out of your Apple ID"}),"\n",(0,s.jsx)(n.li,{children:"When prompted during purchase, use the sandbox account"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["On iOS 14+, you can add sandbox accounts in ",(0,s.jsx)(n.strong,{children:"Settings \u2192 App Store \u2192 Sandbox Account"})," without signing out of your main Apple ID."]})}),"\n",(0,s.jsx)(n.h2,{id:"5-storekit-configuration-file-local-testing",children:"5. StoreKit Configuration File (Local Testing)"}),"\n",(0,s.jsx)(n.p,{children:"For local testing without App Store Connect:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["In Xcode: ",(0,s.jsx)(n.strong,{children:"File \u2192 New \u2192 File \u2192 StoreKit Configuration File"})]}),"\n",(0,s.jsx)(n.li,{children:"Add your products (Product IDs must match exactly)"}),"\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Scheme \u2192 Edit Scheme \u2192 Run \u2192 Options"})]}),"\n",(0,s.jsx)(n.li,{children:"Select your StoreKit Configuration file"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This allows testing purchases without network connectivity to Apple's servers."}),"\n",(0,s.jsx)(n.h2,{id:"6-clean-build",children:"6. Clean Build"}),"\n",(0,s.jsx)(n.p,{children:"StoreKit caching can cause issues. Perform a clean build:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Clean iOS build\ncd ios\nrm -rf Pods Podfile.lock build\npod install --repo-update\ncd ..\n\n# Clean React Native\nwatchman watch-del-all\nrm -rf node_modules\nnpm install  # or yarn\n\n# In Xcode: Product \u2192 Clean Build Folder (Cmd+Shift+K)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"7-code-implementation",children:"7. Code Implementation"}),"\n",(0,s.jsxs)(n.p,{children:["Ensure proper error handling when using ",(0,s.jsx)(n.code,{children:"useIAP"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { useIAP } from 'react-native-iap';\n\nconst { connected, subscriptions, fetchProducts } = useIAP({\n  onPurchaseError: (error) => {\n    console.log('Purchase error:', error.code, error.message);\n  },\n});\n\nuseEffect(() => {\n  const loadProducts = async () => {\n    if (connected) {\n      try {\n        await fetchProducts({\n          skus: ['product_id_1', 'product_id_2'],\n          type: 'subs'\n        });\n      } catch (error) {\n        console.log('Fetch products error:', error);\n      }\n    }\n  };\n  loadProducts();\n}, [connected, fetchProducts]);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"8-understanding-storekiterror-codes",children:"8. Understanding StoreKitError Codes"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Error Code"}),(0,s.jsx)(n.th,{children:"Meaning"}),(0,s.jsx)(n.th,{children:"Solution"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Unknown error"}),(0,s.jsx)(n.td,{children:"Check console for details"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Product not found"}),(0,s.jsx)(n.td,{children:"Verify Product ID and App Store Connect setup"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"Network error"}),(0,s.jsx)(n.td,{children:"Check internet connection"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"System error"}),(0,s.jsx)(n.td,{children:"Restart device, try again"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"StoreKitError error 1"})," typically means:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Product ID mismatch"})," - The SKU doesn't exist in App Store Connect"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Product not active"}),' - Product is not in "Ready to Submit" or "Approved" status']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Agreement issue"})," - App Store Connect agreements need renewal"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bundle ID mismatch"})," - App's bundle ID doesn't match the product's app"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"debugging-checklist",children:"Debugging Checklist"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","App Store Connect agreements are active"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","iOS deployment target is 15.0+"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Product IDs match exactly (case-sensitive)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",'Products are in "Ready to Submit" or "Approved" status']}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Bundle ID matches between app and App Store Connect"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Testing on physical device (not simulator for production testing)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Using sandbox account for testing"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Performed clean build after upgrade"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"common-migration-issues",children:"Common Migration Issues"}),"\n",(0,s.jsx)(n.h3,{id:"products-worked-in-v12v13-but-not-in-v14",children:"Products worked in v12/v13 but not in v14+"}),"\n",(0,s.jsx)(n.p,{children:"StoreKit 2 uses a different API that may have stricter requirements:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure all agreements are current"}),"\n",(0,s.jsx)(n.li,{children:"Verify product configuration hasn't changed"}),"\n",(0,s.jsx)(n.li,{children:"Check that your Apple Developer account is in good standing"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"simulator-vs-device",children:"Simulator vs Device"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simulator"}),": Use StoreKit Configuration file for testing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Physical Device"}),": Use sandbox account with actual App Store Connect products"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"receipt-validation-changes",children:"Receipt Validation Changes"}),"\n",(0,s.jsxs)(n.p,{children:["StoreKit 2 uses JWS (JSON Web Signature) instead of the old receipt format. If you have server-side validation, you'll need to update it. See ",(0,s.jsx)(n.a,{href:"/docs/guides/subscription-validation",children:"Subscription Validation"})," for details."]}),"\n",(0,s.jsx)(n.h2,{id:"still-having-issues",children:"Still Having Issues?"}),"\n",(0,s.jsx)(n.p,{children:"If you've tried all the above:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a minimal reproduction project"}),"\n",(0,s.jsxs)(n.li,{children:["Test with the ",(0,s.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/tree/main/example",children:"example app"})]}),"\n",(0,s.jsxs)(n.li,{children:["Open an issue on ",(0,s.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/issues",children:"GitHub"})," with:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"iOS version"}),"\n",(0,s.jsx)(n.li,{children:"react-native-iap version"}),"\n",(0,s.jsx)(n.li,{children:"Full error message"}),"\n",(0,s.jsx)(n.li,{children:"Code snippet"}),"\n",(0,s.jsx)(n.li,{children:"Steps to reproduce"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var t=i(96540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);