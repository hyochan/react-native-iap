"use strict";(self.webpackChunkreact_native_iap_docs=self.webpackChunkreact_native_iap_docs||[]).push([[6053],{27856:(e,r,n)=>{n.d(r,{I:()=>i,V:()=>s});const s="https://iapkit.com",i="https://www.hyo.dev/api/ad-banner/cmjf0l2460003249hfyh029dm"},28453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>o});var s=n(96540);const i={},t=s.createContext(i);function c(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:r},e.children)}},35159:(e,r,n)=>{n.d(r,{A:()=>o});var s=n(96540),i=n(86025),t=n(27856),c=n(74848);function o({className:e="iapkit-banner",style:r}){const n=(0,i.Ay)("/img/iapkit-banner.gif"),o=(0,s.useCallback)(e=>{fetch(t.I,{method:"POST",mode:"no-cors"}).catch(()=>{})},[]);return(0,c.jsx)("div",{className:e,style:{marginTop:0,marginBottom:12,textAlign:"center",...r},children:(0,c.jsx)("a",{href:t.V,target:"_blank",rel:"noopener noreferrer",onClick:o,style:{display:"inline-block",textDecoration:"none"},children:(0,c.jsx)("img",{src:n,alt:"IapKit - In-App Purchase Validation Service",style:{border:"none",display:"block"}})})})}},71437:(e,r,n)=>{n.d(r,{A:()=>c});var s=n(96540),i=n(27856),t=n(74848);function c({children:e,className:r,style:n}){const c=(0,s.useCallback)(()=>{fetch(i.I,{method:"POST",mode:"no-cors"}).catch(()=>{})},[]);return(0,t.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:c,className:r,style:n,children:e})}},82122:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>d,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"guides/migration-v13-to-v14","title":"Migration Guide (v13 to v14.6)","description":"This guide helps you migrate from react-native-iap v13 to v14.6. Version 14 introduces significant architectural changes including migration to Nitro Modules (JSI-based native bridge), StoreKit 2 for iOS, and Google Play Billing 7.0+ for Android.","source":"@site/versioned_docs/version-14.6/guides/migration-v13-to-v14.md","sourceDirName":"guides","slug":"/guides/migration-v13-to-v14","permalink":"/react-native-iap/docs/14.6/guides/migration-v13-to-v14","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/react-native-iap/tree/main/docs/versioned_docs/version-14.6/guides/migration-v13-to-v14.md","tags":[],"version":"14.6","sidebarPosition":0,"frontMatter":{"title":"Migration Guide (v13 to v14.6)","sidebar_label":"Migration v13 \u2192 v14.6","sidebar_position":0}}');var i=n(74848),t=n(28453),c=n(35159),o=n(71437);const d={title:"Migration Guide (v13 to v14.6)",sidebar_label:"Migration v13 \u2192 v14.6",sidebar_position:0},a="Migration Guide: v13 to v14.6",l={},u=[{value:"Breaking Changes Overview",id:"breaking-changes-overview",level:2},{value:"Architecture Changes",id:"architecture-changes",level:3},{value:"Minimum Requirements",id:"minimum-requirements",level:3},{value:"Removed APIs",id:"removed-apis",level:2},{value:"<code>getProducts()</code> \u2192 <code>fetchProducts()</code>",id:"getproducts--fetchproducts",level:3},{value:"<code>getSubscriptions()</code> \u2192 <code>fetchProducts()</code>",id:"getsubscriptions--fetchproducts",level:3},{value:"<code>clearProductsIOS()</code> \u2192 Removed",id:"clearproductsios--removed",level:3},{value:"<code>flushFailedPurchasesCachedAsPendingAndroid()</code> \u2192 Removed",id:"flushfailedpurchasescachedaspendingandroid--removed",level:3},{value:"<code>buyPromotedProductIOS()</code> \u2192 Use <code>requestPurchase()</code> with listener",id:"buypromotedproductios--use-requestpurchase-with-listener",level:3},{value:"<code>getPurchaseHistory()</code> \u2192 <code>getAvailablePurchases()</code>",id:"getpurchasehistory--getavailablepurchases",level:3},{value:"<code>setup()</code> \u2192 Removed",id:"setup--removed",level:3},{value:"Renamed/Changed APIs",id:"renamedchanged-apis",level:2},{value:"<code>requestPurchase()</code> Parameter Changes",id:"requestpurchase-parameter-changes",level:3},{value:"<code>requestSubscription()</code> \u2192 <code>requestPurchase()</code> with <code>type: &#39;subs&#39;</code>",id:"requestsubscription--requestpurchase-with-type-subs",level:3},{value:"<code>finishTransaction()</code> Changes",id:"finishtransaction-changes",level:3},{value:"<code>validateReceiptIos()</code> \u2192 <code>verifyPurchase()</code>",id:"validatereceiptios--verifypurchase",level:3},{value:"Recommended: Use <code>verifyPurchaseWithProvider()</code> with IAPKit",id:"recommended-use-verifypurchasewithprovider-with-iapkit",level:4},{value:"useIAP Hook Changes",id:"useiap-hook-changes",level:2},{value:"Method Returns",id:"method-returns",level:3},{value:"Removed Hook Methods",id:"removed-hook-methods",level:3},{value:"New Hook Methods",id:"new-hook-methods",level:3},{value:"Complete Migration Example",id:"complete-migration-example",level:2},{value:"Before (v13)",id:"before-v13",level:3},{value:"After (v14)",id:"after-v14",level:3},{value:"Error Handling Changes",id:"error-handling-changes",level:2},{value:"v13 Error Handling",id:"v13-error-handling",level:3},{value:"v14 Error Handling",id:"v14-error-handling",level:3},{value:"Product Type Changes",id:"product-type-changes",level:2},{value:"Product Structure",id:"product-structure",level:3},{value:"Subscription Structure",id:"subscription-structure",level:3},{value:"Android-Specific Changes",id:"android-specific-changes",level:2},{value:"Subscription Offers (Required for Android)",id:"subscription-offers-required-for-android",level:3},{value:"iOS-Specific Changes",id:"ios-specific-changes",level:2},{value:"StoreKit 2 Migration",id:"storekit-2-migration",level:3},{value:"Receipt Changes",id:"receipt-changes",level:3},{value:"Promoted Products",id:"promoted-products",level:3},{value:"Quick Reference Table",id:"quick-reference-table",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Cannot find module&quot; errors",id:"cannot-find-module-errors",level:3},{value:"iOS build errors",id:"ios-build-errors",level:3},{value:"Android build errors",id:"android-build-errors",level:3},{value:"Products not loading",id:"products-not-loading",level:3},{value:"Need Help?",id:"need-help",level:2}];function h(e){const r={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"migration-guide-v13-to-v146",children:"Migration Guide: v13 to v14.6"})}),"\n",(0,i.jsx)(c.A,{}),"\n",(0,i.jsxs)(r.p,{children:["This guide helps you migrate from ",(0,i.jsx)(r.code,{children:"react-native-iap"})," v13 to v14.6. Version 14 introduces significant architectural changes including migration to ",(0,i.jsx)(r.strong,{children:"Nitro Modules"})," (JSI-based native bridge), ",(0,i.jsx)(r.strong,{children:"StoreKit 2"})," for iOS, and ",(0,i.jsx)(r.strong,{children:"Google Play Billing 7.0+"})," for Android."]}),"\n",(0,i.jsx)(r.h2,{id:"breaking-changes-overview",children:"Breaking Changes Overview"}),"\n",(0,i.jsx)(r.h3,{id:"architecture-changes",children:"Architecture Changes"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Aspect"}),(0,i.jsx)(r.th,{children:"v13"}),(0,i.jsx)(r.th,{children:"v14"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Native Bridge"}),(0,i.jsx)(r.td,{children:"React Native Modules"}),(0,i.jsx)(r.td,{children:"Nitro Modules (JSI)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"iOS Stack"}),(0,i.jsx)(r.td,{children:"StoreKit 1"}),(0,i.jsx)(r.td,{children:"StoreKit 2 (iOS 15+)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Android Billing"}),(0,i.jsx)(r.td,{children:"Google Play Billing 6.x"}),(0,i.jsx)(r.td,{children:"Google Play Billing 7.0+"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Product Caching"}),(0,i.jsxs)(r.td,{children:["Manual (",(0,i.jsx)(r.code,{children:"clearProductsIOS"}),")"]}),(0,i.jsx)(r.td,{children:"Automatic (no caching)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Error Handling"}),(0,i.jsx)(r.td,{children:"Platform-specific"}),(0,i.jsxs)(r.td,{children:["Unified ",(0,i.jsx)(r.code,{children:"ErrorCode"})," enum"]})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"minimum-requirements",children:"Minimum Requirements"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"iOS"}),": 15.0+ (required for StoreKit 2)"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Android"}),": Google Play Billing 7.0+"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"React Native"}),": 0.71+"]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"removed-apis",children:"Removed APIs"}),"\n",(0,i.jsxs)(r.p,{children:["The following functions have been ",(0,i.jsx)(r.strong,{children:"completely removed"})," in v14:"]}),"\n",(0,i.jsxs)(r.h3,{id:"getproducts--fetchproducts",children:[(0,i.jsx)(r.code,{children:"getProducts()"})," \u2192 ",(0,i.jsx)(r.code,{children:"fetchProducts()"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {getProducts} from 'react-native-iap';\nconst products = await getProducts({skus: ['product.id']});\n\n// v14\nimport {fetchProducts} from 'react-native-iap';\nconst products = await fetchProducts({skus: ['product.id'], type: 'in-app'});\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"getsubscriptions--fetchproducts",children:[(0,i.jsx)(r.code,{children:"getSubscriptions()"})," \u2192 ",(0,i.jsx)(r.code,{children:"fetchProducts()"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {getSubscriptions} from 'react-native-iap';\nconst subscriptions = await getSubscriptions({skus: ['subscription.id']});\n\n// v14\nimport {fetchProducts} from 'react-native-iap';\nconst subscriptions = await fetchProducts({skus: ['subscription.id'], type: 'subs'});\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"clearproductsios--removed",children:[(0,i.jsx)(r.code,{children:"clearProductsIOS()"})," \u2192 Removed"]}),"\n",(0,i.jsx)(r.p,{children:"Products are no longer cached in v14. This function is not needed."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {clearProductsIOS} from 'react-native-iap';\nawait clearProductsIOS();\n\n// v14\n// Not needed - products are fetched dynamically each time\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"flushfailedpurchasescachedaspendingandroid--removed",children:[(0,i.jsx)(r.code,{children:"flushFailedPurchasesCachedAsPendingAndroid()"})," \u2192 Removed"]}),"\n",(0,i.jsx)(r.p,{children:"This function has been completely removed in v14. The Google Play Billing library now handles failed purchases automatically with improved reconnection logic."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {flushFailedPurchasesCachedAsPendingAndroid} from 'react-native-iap';\nif (Platform.OS === 'android') {\n  await flushFailedPurchasesCachedAsPendingAndroid();\n}\n\n// v14\n// Not needed - billing client handles this automatically\n// Just use getAvailablePurchases() to restore pending purchases if needed\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"buypromotedproductios--use-requestpurchase-with-listener",children:[(0,i.jsx)(r.code,{children:"buyPromotedProductIOS()"})," \u2192 Use ",(0,i.jsx)(r.code,{children:"requestPurchase()"})," with listener"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {buyPromotedProductIOS} from 'react-native-iap';\nawait buyPromotedProductIOS();\n\n// v14\nimport {promotedProductListenerIOS, requestPurchase} from 'react-native-iap';\n\n// Set up listener for promoted products\nconst subscription = promotedProductListenerIOS((product) => {\n  // Purchase the promoted product directly\n  requestPurchase({\n    request: {apple: {sku: product.id}},\n    type: 'in-app',\n  });\n});\n\n// Clean up when done\nsubscription.remove();\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"getpurchasehistory--getavailablepurchases",children:[(0,i.jsx)(r.code,{children:"getPurchaseHistory()"})," \u2192 ",(0,i.jsx)(r.code,{children:"getAvailablePurchases()"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {getPurchaseHistory} from 'react-native-iap';\nconst history = await getPurchaseHistory();\n\n// v14\nimport {getAvailablePurchases} from 'react-native-iap';\nconst purchases = await getAvailablePurchases();\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"setup--removed",children:[(0,i.jsx)(r.code,{children:"setup()"})," \u2192 Removed"]}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"setup()"})," function for configuring StoreKit mode is no longer needed. v14 uses StoreKit 2 by default."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {setup} from 'react-native-iap';\nsetup({storekitMode: 'STOREKIT2_MODE'});\n\n// v14\n// Not needed - StoreKit 2 is used by default\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"renamedchanged-apis",children:"Renamed/Changed APIs"}),"\n",(0,i.jsxs)(r.h3,{id:"requestpurchase-parameter-changes",children:[(0,i.jsx)(r.code,{children:"requestPurchase()"})," Parameter Changes"]}),"\n",(0,i.jsxs)(r.p,{children:["The purchase request structure has changed to use ",(0,i.jsx)(r.code,{children:"apple"}),"/",(0,i.jsx)(r.code,{children:"google"})," instead of ",(0,i.jsx)(r.code,{children:"ios"}),"/",(0,i.jsx)(r.code,{children:"android"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {requestPurchase} from 'react-native-iap';\nawait requestPurchase({\n  sku: 'product.id',\n  andDangerouslyFinishTransactionAutomaticallyIOS: false,\n});\n\n// v14\nimport {requestPurchase} from 'react-native-iap';\nawait requestPurchase({\n  request: {\n    apple: {sku: 'product.id'},\n    google: {skus: ['product.id']},\n  },\n  type: 'in-app',\n});\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"requestsubscription--requestpurchase-with-type-subs",children:[(0,i.jsx)(r.code,{children:"requestSubscription()"})," \u2192 ",(0,i.jsx)(r.code,{children:"requestPurchase()"})," with ",(0,i.jsx)(r.code,{children:"type: 'subs'"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {requestSubscription} from 'react-native-iap';\nawait requestSubscription({\n  sku: 'subscription.id',\n  subscriptionOffers: [{sku: 'subscription.id', offerToken: 'token'}],\n});\n\n// v14\nimport {requestPurchase} from 'react-native-iap';\nawait requestPurchase({\n  request: {\n    apple: {sku: 'subscription.id'},\n    google: {\n      skus: ['subscription.id'],\n      subscriptionOffers: [{sku: 'subscription.id', offerToken: 'token'}],\n    },\n  },\n  type: 'subs',\n});\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"finishtransaction-changes",children:[(0,i.jsx)(r.code,{children:"finishTransaction()"})," Changes"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {finishTransaction} from 'react-native-iap';\nawait finishTransaction({\n  purchase,\n  isConsumable: true,\n  developerPayloadAndroid: 'payload',\n});\n\n// v14\nimport {finishTransaction} from 'react-native-iap';\nawait finishTransaction({\n  purchase,\n  isConsumable: true,\n});\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"validatereceiptios--verifypurchase",children:[(0,i.jsx)(r.code,{children:"validateReceiptIos()"})," \u2192 ",(0,i.jsx)(r.code,{children:"verifyPurchase()"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nimport {validateReceiptIos} from 'react-native-iap';\nconst result = await validateReceiptIos({\n  receiptBody: {...},\n  isTest: true,\n});\n\n// v14\nimport {verifyPurchase} from 'react-native-iap';\nconst result = await verifyPurchase({\n  apple: {sku: 'product.id'},\n  google: {\n    sku: 'product.id',\n    packageName: 'com.example.app',\n    purchaseToken: 'token',\n    accessToken: 'your-google-api-access-token',\n  },\n});\n"})}),"\n",(0,i.jsxs)(r.h4,{id:"recommended-use-verifypurchasewithprovider-with-iapkit",children:["Recommended: Use ",(0,i.jsx)(r.code,{children:"verifyPurchaseWithProvider()"})," with IAPKit"]}),"\n",(0,i.jsxs)(r.p,{children:["For production apps, we strongly recommend using ",(0,i.jsx)(r.code,{children:"verifyPurchaseWithProvider()"})," with ",(0,i.jsx)(o.A,{children:"IAPKit"})," for secure server-side validation. This provides enterprise-grade backend verification without requiring your own server setup."]}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Why IAPKit?"})," Client-only verification is vulnerable to receipt tampering and fraud. ",(0,i.jsx)(o.A,{children:"IAPKit"})," provides secure server-side validation with a unified API for both Apple and Google purchases. See the ",(0,i.jsx)(r.a,{href:"/blog/release-14.5.0",children:"v14.5.0 release blog"})," for details."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"import {verifyPurchaseWithProvider} from 'react-native-iap';\n\nconst result = await verifyPurchaseWithProvider({\n  provider: 'iapkit',\n  iapkit: {\n    apiKey: 'your-iapkit-api-key', // Get your key at https://iapkit.com\n    apple: {jws: purchase.purchaseToken!},\n    google: {purchaseToken: purchase.purchaseToken!},\n  },\n});\n\nif (result.iapkit?.isValid) {\n  // Purchase verified - grant entitlement\n  console.log('Purchase state:', result.iapkit.state); // 'entitled', 'pending', 'expired', etc.\n  console.log('Store:', result.iapkit.store); // 'apple' or 'google'\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Note"}),": IAPKit requires a POST request to their API for validation. Sign up at ",(0,i.jsx)(o.A,{children:"iapkit.com"})," to get your API key."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"useiap-hook-changes",children:"useIAP Hook Changes"}),"\n",(0,i.jsx)(r.h3,{id:"method-returns",children:"Method Returns"}),"\n",(0,i.jsxs)(r.p,{children:["In v14, most ",(0,i.jsx)(r.code,{children:"useIAP"})," methods return ",(0,i.jsx)(r.code,{children:"Promise<void>"})," and update internal state instead of returning data:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nconst {getProducts, products} = useIAP();\nconst fetchedProducts = await getProducts({skus: ['product.id']});\nconsole.log(fetchedProducts); // Products returned directly\n\n// v14\nconst {fetchProducts, products} = useIAP();\nawait fetchProducts({skus: ['product.id'], type: 'in-app'});\n// Read from state after fetch\nconsole.log(products); // Products from hook state\n"})}),"\n",(0,i.jsx)(r.h3,{id:"removed-hook-methods",children:"Removed Hook Methods"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"getProducts()"})," \u2192 ",(0,i.jsx)(r.code,{children:"fetchProducts()"})]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"getSubscriptions()"})," \u2192 ",(0,i.jsx)(r.code,{children:"fetchProducts()"})," with ",(0,i.jsx)(r.code,{children:"type: 'subs'"})]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"requestSubscription()"})," \u2192 ",(0,i.jsx)(r.code,{children:"requestPurchase()"})," with ",(0,i.jsx)(r.code,{children:"type: 'subs'"})]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"getPurchaseHistory()"})," \u2192 ",(0,i.jsx)(r.code,{children:"getAvailablePurchases()"})]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"new-hook-methods",children:"New Hook Methods"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"const {\n  // New in v14\n  fetchProducts,           // Unified product fetching\n  getActiveSubscriptions,  // Get active subscriptions (returns data!)\n  hasActiveSubscriptions,  // Check if user has active subscriptions\n  activeSubscriptions,     // State for active subscriptions\n} = useIAP();\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"complete-migration-example",children:"Complete Migration Example"}),"\n",(0,i.jsx)(r.h3,{id:"before-v13",children:"Before (v13)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"import {\n  initConnection,\n  endConnection,\n  getProducts,\n  getSubscriptions,\n  requestPurchase,\n  requestSubscription,\n  finishTransaction,\n  purchaseUpdatedListener,\n  purchaseErrorListener,\n  clearProductsIOS,\n  flushFailedPurchasesCachedAsPendingAndroid,\n} from 'react-native-iap';\n\nconst productSkus = ['com.app.product1'];\nconst subscriptionSkus = ['com.app.subscription1'];\n\nexport const useInitIAP = () => {\n  useEffect(() => {\n    const init = async () => {\n      await initConnection();\n\n      if (Platform.OS === 'android') {\n        await flushFailedPurchasesCachedAsPendingAndroid();\n      } else {\n        await clearProductsIOS();\n      }\n\n      // Fetch products\n      const products = await getProducts({skus: productSkus});\n      const subscriptions = await getSubscriptions({skus: subscriptionSkus});\n    };\n\n    init();\n    return () => endConnection();\n  }, []);\n};\n\n// Purchase\nconst buyProduct = async (sku: string) => {\n  await requestPurchase({sku});\n};\n\nconst buySubscription = async (sku: string, offerToken?: string) => {\n  await requestSubscription({\n    sku,\n    subscriptionOffers: offerToken ? [{sku, offerToken}] : undefined,\n  });\n};\n"})}),"\n",(0,i.jsx)(r.h3,{id:"after-v14",children:"After (v14)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"import {\n  useIAP,\n  fetchProducts,\n  requestPurchase,\n  finishTransaction,\n  ErrorCode,\n} from 'react-native-iap';\n\nconst productSkus = ['com.app.product1'];\nconst subscriptionSkus = ['com.app.subscription1'];\n\nexport const MyStoreComponent = () => {\n  const {\n    connected,\n    products,\n    subscriptions,\n    fetchProducts,\n    requestPurchase,\n    finishTransaction,\n  } = useIAP({\n    onPurchaseSuccess: async (purchase) => {\n      console.log('Purchase successful:', purchase.productId);\n      // Validate on your server, then finish\n      await finishTransaction({purchase, isConsumable: false});\n    },\n    onPurchaseError: (error) => {\n      if (error.code !== ErrorCode.UserCancelled) {\n        console.error('Purchase failed:', error.message);\n      }\n    },\n  });\n\n  useEffect(() => {\n    if (!connected) return;\n\n    // Fetch products (unified API)\n    fetchProducts({skus: productSkus, type: 'in-app'});\n    fetchProducts({skus: subscriptionSkus, type: 'subs'});\n  }, [connected, fetchProducts]);\n\n  // Purchase product\n  const buyProduct = async (productId: string) => {\n    await requestPurchase({\n      request: {\n        apple: {sku: productId},\n        google: {skus: [productId]},\n      },\n      type: 'in-app',\n    });\n  };\n\n  // Purchase subscription\n  const buySubscription = async (subscriptionId: string) => {\n    const subscription = subscriptions.find((s) => s.id === subscriptionId);\n    const offers = subscription?.subscriptionOfferDetailsAndroid ?? [];\n\n    await requestPurchase({\n      request: {\n        apple: {sku: subscriptionId},\n        google: {\n          skus: [subscriptionId],\n          ...(offers.length > 0 && {\n            subscriptionOffers: offers.map((o) => ({\n              sku: subscriptionId,\n              offerToken: o.offerToken,\n            })),\n          }),\n        },\n      },\n      type: 'subs',\n    });\n  };\n\n  return (\n    <View>\n      {products.map((product) => (\n        <Button\n          key={product.id}\n          title={`${product.title} - ${product.displayPrice}`}\n          onPress={() => buyProduct(product.id)}\n        />\n      ))}\n      {subscriptions.map((sub) => (\n        <Button\n          key={sub.id}\n          title={`${sub.title} - ${sub.displayPrice}`}\n          onPress={() => buySubscription(sub.id)}\n        />\n      ))}\n    </View>\n  );\n};\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"error-handling-changes",children:"Error Handling Changes"}),"\n",(0,i.jsx)(r.h3,{id:"v13-error-handling",children:"v13 Error Handling"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\npurchaseErrorListener((error) => {\n  console.error('Error code:', error.code);\n  console.error('Error message:', error.message);\n});\n"})}),"\n",(0,i.jsx)(r.h3,{id:"v14-error-handling",children:"v14 Error Handling"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v14 - Using unified ErrorCode enum\nimport {purchaseErrorListener, ErrorCode, isUserCancelledError} from 'react-native-iap';\n\npurchaseErrorListener((error) => {\n  // Helper function\n  if (isUserCancelledError(error)) {\n    return; // User cancelled, no action needed\n  }\n\n  // Or use ErrorCode enum directly\n  switch (error.code) {\n    case ErrorCode.UserCancelled:\n      // User cancelled\n      break;\n    case ErrorCode.ItemUnavailable:\n      Alert.alert('Product not available');\n      break;\n    case ErrorCode.NetworkError:\n      Alert.alert('Network error, please try again');\n      break;\n    default:\n      Alert.alert('Purchase failed', error.message);\n  }\n});\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"product-type-changes",children:"Product Type Changes"}),"\n",(0,i.jsx)(r.h3,{id:"product-structure",children:"Product Structure"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13 - Product type\ninterface Product {\n  productId: string;\n  price: string;\n  localizedPrice: string;\n  title: string;\n  description: string;\n  // ...\n}\n\n// v14 - Product type\ninterface Product {\n  id: string;              // Changed from productId\n  displayPrice: string;    // Changed from localizedPrice\n  price: number;           // Now a number\n  title: string;\n  description: string;\n  platform: 'ios' | 'android';\n  // ...\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"subscription-structure",children:"Subscription Structure"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v14 - Subscription has additional fields\ninterface ProductSubscription extends Product {\n  subscriptionOfferDetailsAndroid?: SubscriptionOfferAndroid[];\n  subscriptionPeriodIOS?: string;\n  // ... additional subscription-specific fields\n}\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"android-specific-changes",children:"Android-Specific Changes"}),"\n",(0,i.jsx)(r.h3,{id:"subscription-offers-required-for-android",children:"Subscription Offers (Required for Android)"}),"\n",(0,i.jsxs)(r.p,{children:["Android subscriptions now ",(0,i.jsx)(r.strong,{children:"require"})," ",(0,i.jsx)(r.code,{children:"subscriptionOffers"})," from the fetched product:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v14 - Android subscriptions\nconst subscription = subscriptions.find((s) => s.id === 'sub.id');\nconst offers = subscription?.subscriptionOfferDetailsAndroid ?? [];\n\nawait requestPurchase({\n  request: {\n    google: {\n      skus: ['sub.id'],\n      subscriptionOffers: offers.map((offer) => ({\n        sku: 'sub.id',\n        offerToken: offer.offerToken,\n      })),\n    },\n  },\n  type: 'subs',\n});\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"ios-specific-changes",children:"iOS-Specific Changes"}),"\n",(0,i.jsx)(r.h3,{id:"storekit-2-migration",children:"StoreKit 2 Migration"}),"\n",(0,i.jsx)(r.p,{children:"v14 uses StoreKit 2 exclusively, which means:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"iOS 15+ required"}),": Your app must target iOS 15.0 or later"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"JWS format"}),": Receipts are now in JWS (JSON Web Signature) format instead of base64"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"No more receipt refresh"}),": ",(0,i.jsx)(r.code,{children:"requestReceiptRefresh"})," behavior has changed"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"receipt-changes",children:"Receipt Changes"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13 - Binary receipt\nconst receipt = await getReceiptIOS({forceRefresh: true});\n// Returns base64-encoded ASN.1 receipt\n\n// v14 - JWS format\nconst receipt = await getReceiptIOS();\n// Returns JWS (JSON Web Signature) string for StoreKit 2\n"})}),"\n",(0,i.jsx)(r.h3,{id:"promoted-products",children:"Promoted Products"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// v13\nawait buyPromotedProductIOS();\n\n// v14 - Use listener + standard purchase flow\npromotedProductListenerIOS((product) => {\n  requestPurchase({\n    request: {apple: {sku: product.id}},\n    type: 'in-app',\n  });\n});\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"quick-reference-table",children:"Quick Reference Table"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"v13 API"}),(0,i.jsx)(r.th,{children:"v14 API"}),(0,i.jsx)(r.th,{children:"Notes"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"getProducts({skus})"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"fetchProducts({skus, type: 'in-app'})"})}),(0,i.jsx)(r.td,{children:"Returns products directly or updates state"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"getSubscriptions({skus})"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"fetchProducts({skus, type: 'subs'})"})}),(0,i.jsx)(r.td,{children:"Unified with fetchProducts"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"clearProductsIOS()"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.em,{children:"Removed"})}),(0,i.jsx)(r.td,{children:"Not needed, no caching"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"requestPurchase({sku})"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"requestPurchase({request: {apple, google}, type})"})}),(0,i.jsx)(r.td,{children:"New structure"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"requestSubscription({sku})"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"requestPurchase({..., type: 'subs'})"})}),(0,i.jsx)(r.td,{children:"Unified with requestPurchase"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"buyPromotedProductIOS()"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"promotedProductListenerIOS()"})," + ",(0,i.jsx)(r.code,{children:"requestPurchase()"})]}),(0,i.jsx)(r.td,{children:"Use listener pattern"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"getPurchaseHistory()"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"getAvailablePurchases()"})}),(0,i.jsx)(r.td,{children:"Different name"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"setup({storekitMode})"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.em,{children:"Removed"})}),(0,i.jsx)(r.td,{children:"StoreKit 2 by default"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"validateReceiptIos()"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"verifyPurchase()"})}),(0,i.jsx)(r.td,{children:"Unified validation"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"product.productId"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"product.id"})}),(0,i.jsx)(r.td,{children:"Property renamed"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"product.localizedPrice"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"product.displayPrice"})}),(0,i.jsx)(r.td,{children:"Property renamed"})]})]})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(r.h3,{id:"cannot-find-module-errors",children:'"Cannot find module" errors'}),"\n",(0,i.jsx)(r.p,{children:"Make sure you've updated all imports:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"// Check for old imports\nimport {getProducts, getSubscriptions} from 'react-native-iap'; // Will fail\n\n// Update to new imports\nimport {fetchProducts} from 'react-native-iap'; // Correct\n"})}),"\n",(0,i.jsx)(r.h3,{id:"ios-build-errors",children:"iOS build errors"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["Clean your build folder: ",(0,i.jsx)(r.code,{children:"cd ios && rm -rf build && pod install"})]}),"\n",(0,i.jsx)(r.li,{children:"Ensure minimum deployment target is iOS 15.0"}),"\n",(0,i.jsx)(r.li,{children:"Update your Podfile if needed"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"android-build-errors",children:"Android build errors"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["Clean gradle: ",(0,i.jsx)(r.code,{children:"cd android && ./gradlew clean"})]}),"\n",(0,i.jsx)(r.li,{children:"Ensure you're using Google Play Billing 7.0+"}),"\n",(0,i.jsxs)(r.li,{children:["Check your ",(0,i.jsx)(r.code,{children:"build.gradle"})," for correct dependencies"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"products-not-loading",children:"Products not loading"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Verify product IDs match exactly with store configuration"}),"\n",(0,i.jsx)(r.li,{children:"Check App Store Connect / Google Play Console agreements are signed"}),"\n",(0,i.jsx)(r.li,{children:"For iOS, ensure you're testing on a real device with StoreKit Configuration or sandbox account"}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"need-help",children:"Need Help?"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/hyochan/react-native-iap/issues",children:"GitHub Issues"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/hyochan/react-native-iap/discussions",children:"GitHub Discussions"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"../api/",children:"API Reference"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"./error-handling",children:"Error Handling Guide"})}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);