"use strict";(self.webpackChunkreact_native_iap_docs=self.webpackChunkreact_native_iap_docs||[]).push([[363],{571:(e,n,i)=>{i.d(n,{A:()=>s});var t=i(6540),l=i(4848);function r({className:e="adfit",style:n,unit:i,height:r,width:s}){return(0,t.useEffect)(()=>{const n=setTimeout(()=>{const n=document.querySelector(`.${e}`);if(!n)return void console.warn(`AdFit: Element with class "${e}" not found`);const t=n.querySelectorAll(".kakao_ad_area"),l=n.querySelectorAll('script[src*="kas/static/ba.min.js"]');t.forEach(e=>e.remove()),l.forEach(e=>e.remove());const o=document.createElement("ins"),a=document.createElement("script");o.className="kakao_ad_area",o.style.cssText="display:none; width:100%;",a.async=!0,a.type="text/javascript",a.src="//t1.daumcdn.net/kas/static/ba.min.js",o.setAttribute("data-ad-width",s.toString()),o.setAttribute("data-ad-height",r.toString()),o.setAttribute("data-ad-unit",i),n.appendChild(o),n.appendChild(a)},100);return()=>clearTimeout(n)},[e,i,r,s]),(0,l.jsx)("div",{style:n,children:(0,l.jsx)("div",{className:e})})}function s(){return(0,l.jsx)(r,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},7557:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"examples/alternative-billing","title":"Alternative Billing Example","description":"Use alternative billing to redirect users to external payment systems or offer payment choices alongside platform billing.","source":"@site/docs/examples/alternative-billing.md","sourceDirName":"examples","slug":"/examples/alternative-billing","permalink":"/react-native-iap/docs/examples/alternative-billing","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/react-native-iap/tree/main/docs/docs/examples/alternative-billing.md","tags":[],"version":"current","sidebarPosition":4.5,"frontMatter":{"title":"Alternative Billing Example","sidebar_label":"Alternative Billing","sidebar_position":4.5},"sidebar":"tutorialSidebar","previous":{"title":"Offer Code","permalink":"/react-native-iap/docs/examples/offer-code"},"next":{"title":"Sponsors","permalink":"/react-native-iap/docs/sponsors"}}');var l=i(4848),r=i(8453),s=i(571);const o={title:"Alternative Billing Example",sidebar_label:"Alternative Billing",sidebar_position:4.5},a="Alternative Billing",c={},d=[{value:"iOS - External Purchase URL",id:"ios---external-purchase-url",level:2},{value:"Important Notes",id:"important-notes",level:3},{value:"Android - Alternative Billing Only",id:"android---alternative-billing-only",level:2},{value:"Flow Steps",id:"flow-steps",level:3},{value:"Android - User Choice Billing",id:"android---user-choice-billing",level:2},{value:"Selection Dialog",id:"selection-dialog",level:3},{value:"Complete Cross-Platform Example",id:"complete-cross-platform-example",level:2},{value:"Configuration",id:"configuration",level:2},{value:"useIAP Hook",id:"useiap-hook",level:3},{value:"Root API",id:"root-api",level:3},{value:"Testing",id:"testing",level:2},{value:"iOS",id:"ios",level:3},{value:"Android",id:"android",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"alternative-billing",children:"Alternative Billing"})}),"\n",(0,l.jsx)(s.A,{}),"\n",(0,l.jsx)(n.p,{children:"Use alternative billing to redirect users to external payment systems or offer payment choices alongside platform billing."}),"\n",(0,l.jsx)(n.p,{children:"View the full example source:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["GitHub: ",(0,l.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/blob/main/example/screens/AlternativeBilling.tsx",children:"AlternativeBilling.tsx"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"ios---external-purchase-url",children:"iOS - External Purchase URL"}),"\n",(0,l.jsx)(n.p,{children:"Redirect users to an external website for payment (iOS 16.0+):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"import {Platform, Button, Alert} from 'react-native';\nimport {requestPurchase, type Product} from 'react-native-iap';\n\nfunction IosAlternativeBilling({product}: {product: Product}) {\n  const handlePurchase = async () => {\n    if (Platform.OS !== 'ios') return;\n\n    try {\n      await requestPurchase({\n        request: {\n          ios: {\n            sku: product.productId,\n            quantity: 1,\n          },\n        },\n        type: 'in-app',\n        useAlternativeBilling: true,\n      });\n\n      Alert.alert(\n        'Redirected',\n        'Complete purchase on the external website. You will be redirected back to the app.',\n      );\n    } catch (error: any) {\n      if (error.code !== 'user-cancelled') {\n        Alert.alert('Error', error.message);\n      }\n    }\n  };\n\n  return <Button title=\"Buy (External URL)\" onPress={handlePurchase} />;\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"important-notes",children:"Important Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"iOS 16.0+ Required"}),": External URLs only work on iOS 16.0 and later"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Configuration Required"}),": External URLs must be configured in your Expo config or React Native CLI project (see ",(0,l.jsx)(n.a,{href:"/docs/guides/alternative-billing",children:"Alternative Billing Guide"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"No Callback"}),": ",(0,l.jsx)(n.code,{children:"onPurchaseSuccess"})," will NOT fire when using external URLs"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deep Linking"}),": Implement deep linking to return users to your app"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"android---alternative-billing-only",children:"Android - Alternative Billing Only"}),"\n",(0,l.jsx)(n.p,{children:"Manual 3-step flow for alternative billing only:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"import {Platform, Button, Alert} from 'react-native';\nimport {\n  checkAlternativeBillingAvailabilityAndroid,\n  showAlternativeBillingDialogAndroid,\n  createAlternativeBillingTokenAndroid,\n  type Product,\n} from 'react-native-iap';\n\nfunction AndroidAlternativeBillingOnly({product}: {product: Product}) {\n  const handlePurchase = async () => {\n    if (Platform.OS !== 'android') return;\n\n    try {\n      // Step 1: Check availability\n      const isAvailable = await checkAlternativeBillingAvailabilityAndroid();\n      if (!isAvailable) {\n        Alert.alert('Error', 'Alternative billing not available');\n        return;\n      }\n\n      // Step 2: Show information dialog\n      const userAccepted = await showAlternativeBillingDialogAndroid();\n      if (!userAccepted) {\n        console.log('User declined');\n        return;\n      }\n\n      // Step 2.5: Process payment with your payment system\n      // ... your payment processing logic here ...\n      console.log('Processing payment...');\n\n      // Step 3: Create reporting token (after successful payment)\n      const token = await createAlternativeBillingTokenAndroid(\n        product.productId,\n      );\n      console.log('Token created:', token);\n\n      // Step 4: Report token to Google Play backend within 24 hours\n      // await reportToGoogleBackend(token);\n\n      Alert.alert('Success', 'Alternative billing completed (DEMO)');\n    } catch (error: any) {\n      Alert.alert('Error', error.message);\n    }\n  };\n\n  return <Button title=\"Buy (Alternative Only)\" onPress={handlePurchase} />;\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"flow-steps",children:"Flow Steps"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check availability"})," - Verify alternative billing is enabled"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Show info dialog"})," - Display Google's information dialog"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Process payment"})," - Handle payment with your system"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Create token"})," - Generate reporting token"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Report to Google"})," - Send token to Google within 24 hours"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"android---user-choice-billing",children:"Android - User Choice Billing"}),"\n",(0,l.jsx)(n.p,{children:"Let users choose between Google Play and alternative billing:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"import {Platform, Button} from 'react-native';\nimport {useIAP, requestPurchase, type Product} from 'react-native-iap';\n\nfunction AndroidUserChoiceBilling({product}: {product: Product}) {\n  // Initialize with user choice mode\n  const {connected} = useIAP({\n    alternativeBillingModeAndroid: 'user-choice',\n    onPurchaseSuccess: (purchase) => {\n      // Fires if user selects Google Play\n      console.log('Google Play purchase:', purchase);\n    },\n  });\n\n  const handlePurchase = async () => {\n    if (Platform.OS !== 'android' || !connected) return;\n\n    try {\n      // Google will show selection dialog automatically\n      await requestPurchase({\n        request: {\n          android: {\n            skus: [product.productId],\n          },\n        },\n        type: 'in-app',\n        useAlternativeBilling: true,\n      });\n\n      // If user selects Google Play: onPurchaseSuccess fires\n      // If user selects alternative: manual flow required\n    } catch (error: any) {\n      console.error('Purchase error:', error);\n    }\n  };\n\n  return <Button title=\"Buy (User Choice)\" onPress={handlePurchase} />;\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"selection-dialog",children:"Selection Dialog"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Google shows automatic selection dialog"}),"\n",(0,l.jsx)(n.li,{children:"User chooses: Google Play (30% fee) or Alternative (lower fee)"}),"\n",(0,l.jsx)(n.li,{children:"Different callbacks based on user choice"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"complete-cross-platform-example",children:"Complete Cross-Platform Example"}),"\n",(0,l.jsxs)(n.p,{children:["For a fully working cross-platform implementation, see ",(0,l.jsx)(n.a,{href:"https://github.com/hyochan/react-native-iap/blob/main/example/screens/AlternativeBilling.tsx",children:"AlternativeBilling.tsx"})," in the example app."]}),"\n",(0,l.jsx)(n.p,{children:"The complete example includes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"iOS"}),": External purchase URL handling with notice sheets"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Android Alternative Only"}),": 3-step manual flow with token generation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Android User Choice"}),": Automatic selection dialog handling"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Mode Switching"}),": Toggle between alternative billing modes"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Error Handling"}),": Comprehensive error handling for all platforms"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"UI Integration"}),": Product list with purchase buttons"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"useiap-hook",children:"useIAP Hook"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"const {connected} = useIAP({\n  alternativeBillingModeAndroid: 'alternative-only', // or 'user-choice' or 'none'\n});\n"})}),"\n",(0,l.jsx)(n.h3,{id:"root-api",children:"Root API"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"import {initConnection} from 'react-native-iap';\n\nawait initConnection({\n  alternativeBillingModeAndroid: 'alternative-only',\n});\n"})}),"\n",(0,l.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,l.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Test on iOS 16.0+ devices"}),"\n",(0,l.jsx)(n.li,{children:"Verify external URL opens in Safari"}),"\n",(0,l.jsx)(n.li,{children:"Test deep link return flow"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Configure alternative billing in Google Play Console"}),"\n",(0,l.jsx)(n.li,{children:"Test both modes separately"}),"\n",(0,l.jsx)(n.li,{children:"Verify token generation"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Backend Validation"})," - Always validate on server"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Clear UI"})," - Show users they're leaving the app"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Error Handling"})," - Handle all error cases"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Token Reporting"})," - Report within 24 hours (Android)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deep Linking"})," - Essential for iOS return flow"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/guides/alternative-billing",children:"Alternative Billing Guide"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/guides/error-handling",children:"Error Handling"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/examples/purchase-flow",children:"Purchase Flow"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var t=i(6540);const l={},r=t.createContext(l);function s(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);